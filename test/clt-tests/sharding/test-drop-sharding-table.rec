––– input –––
export INSTANCE=1
––– output –––
––– block: ./base/flexible/start-searchd –––
––– input –––
export INSTANCE=2
––– output –––
––– block: ./base/flexible/start-searchd –––
––– input –––
export CLUSTER_NAME=c
––– output –––
––– input –––
mysql -h0 -P1306 -e "create cluster ${CLUSTER_NAME}"
––– output –––
––– input –––
mysql -h0 -P1306 -e "show status like 'cluster_${CLUSTER_NAME}_status'\G"
––– output –––
*************************** 1. row ***************************
Counter: cluster_#!/[a-z]+/!#_status
Value: primary
––– input –––
export CLUSTER_NAME=c
––– output –––
––– input –––
for n in `seq 2 $INSTANCE`; do mysql -h0 -P${n}306 -e "join cluster ${CLUSTER_NAME} at '127.0.0.1:1312'"; done;
––– output –––
––– input –––
mysql -h0 -P${INSTANCE}306 -e "show status like 'cluster_${CLUSTER_NAME}_status'\G"
––– output –––
*************************** 1. row ***************************
Counter: cluster_#!/[a-z]+/!#_status
Value: primary
––– input –––
mysql -h0 -P1306 -e "show status like 'cluster_${CLUSTER_NAME}_status'\G"
––– output –––
*************************** 1. row ***************************
Counter: cluster_c_status
Value: primary
––– input –––
mysql -h0 -P1306 -e "create table ${CLUSTER_NAME}:tbl1(id bigint) shards=10 rf=1;"
––– output –––
––– input –––
mysql -h0 -P2306 -e "create table ${CLUSTER_NAME}:tbl2(id bigint) shards=10 rf=1;"
––– output –––
––– input –––
mysql -h0 -P1306 -e "SHOW TABLES\G"
––– output –––
*************************** 1. row ***************************
Index: _sharding_queue
Type: rt
*************************** 2. row ***************************
Index: _sharding_state
Type: rt
*************************** 3. row ***************************
Index: _sharding_table
Type: rt
*************************** 4. row ***************************
Index: tbl1
Type: distributed
*************************** 5. row ***************************
Index: tbl1_s0
Type: rt
*************************** 6. row ***************************
Index: tbl1_s2
Type: rt
*************************** 7. row ***************************
Index: tbl1_s4
Type: rt
*************************** 8. row ***************************
Index: tbl1_s6
Type: rt
*************************** 9. row ***************************
Index: tbl1_s8
Type: rt
*************************** 10. row ***************************
Index: tbl2
Type: distributed
*************************** 11. row ***************************
Index: tbl2_s0
Type: rt
*************************** 12. row ***************************
Index: tbl2_s2
Type: rt
*************************** 13. row ***************************
Index: tbl2_s4
Type: rt
*************************** 14. row ***************************
Index: tbl2_s6
Type: rt
*************************** 15. row ***************************
Index: tbl2_s8
Type: rt
––– input –––
mysql -h0 -P2306 -e "SHOW TABLES\G"
––– output –––
*************************** 1. row ***************************
Index: _sharding_queue
Type: rt
*************************** 2. row ***************************
Index: _sharding_state
Type: rt
*************************** 3. row ***************************
Index: _sharding_table
Type: rt
*************************** 4. row ***************************
Index: tbl1
Type: distributed
*************************** 5. row ***************************
Index: tbl1_s1
Type: rt
*************************** 6. row ***************************
Index: tbl1_s3
Type: rt
*************************** 7. row ***************************
Index: tbl1_s5
Type: rt
*************************** 8. row ***************************
Index: tbl1_s7
Type: rt
*************************** 9. row ***************************
Index: tbl1_s9
Type: rt
*************************** 10. row ***************************
Index: tbl2
Type: distributed
*************************** 11. row ***************************
Index: tbl2_s1
Type: rt
*************************** 12. row ***************************
Index: tbl2_s3
Type: rt
*************************** 13. row ***************************
Index: tbl2_s5
Type: rt
*************************** 14. row ***************************
Index: tbl2_s7
Type: rt
*************************** 15. row ***************************
Index: tbl2_s9
Type: rt
––– input –––
mysql -h0 -P1306 -e "DROP SHARDED TABLE ${CLUSTER_NAME}:tbl1;"
––– output –––
––– input –––
mysql -h0 -P2306 -e "DROP SHARDED TABLE ${CLUSTER_NAME}:tbl2;"
––– output –––
––– input –––
mysql -h0 -P1306 -e "SHOW TABLES\G"
––– output –––
*************************** 1. row ***************************
Index: _sharding_queue
Type: rt
*************************** 2. row ***************************
Index: _sharding_state
Type: rt
*************************** 3. row ***************************
Index: _sharding_table
Type: rt
*************************** 4. row ***************************
Index: tbl2
Type: distributed
*************************** 5. row ***************************
Index: tbl2_s0
Type: rt
*************************** 6. row ***************************
Index: tbl2_s2
Type: rt
*************************** 7. row ***************************
Index: tbl2_s4
Type: rt
*************************** 8. row ***************************
Index: tbl2_s6
Type: rt
*************************** 9. row ***************************
Index: tbl2_s8
Type: rt
––– input –––
mysql -h0 -P2306 -e "SHOW TABLES\G"
––– output –––
*************************** 1. row ***************************
Index: _sharding_queue
Type: rt
*************************** 2. row ***************************
Index: _sharding_state
Type: rt
*************************** 3. row ***************************
Index: _sharding_table
Type: rt
*************************** 4. row ***************************
Index: tbl1
Type: distributed
*************************** 5. row ***************************
Index: tbl1_s1
Type: rt
*************************** 6. row ***************************
Index: tbl1_s3
Type: rt
*************************** 7. row ***************************
Index: tbl1_s5
Type: rt
*************************** 8. row ***************************
Index: tbl1_s7
Type: rt
*************************** 9. row ***************************
Index: tbl1_s9
Type: rt
*************************** 10. row ***************************
Index: tbl2
Type: distributed
*************************** 11. row ***************************
Index: tbl2_s1
Type: rt
*************************** 12. row ***************************
Index: tbl2_s3
Type: rt
*************************** 13. row ***************************
Index: tbl2_s5
Type: rt
*************************** 14. row ***************************
Index: tbl2_s7
Type: rt
*************************** 15. row ***************************
Index: tbl2_s9
Type: rt
