––– input –––
export INSTANCE=1
––– output –––
––– block: ./base/flexible/start-searchd –––
––– input –––
export INSTANCE=2
––– output –––
––– block: ./base/flexible/start-searchd –––
––– input –––
CLUSTER_NAME=c
––– output –––
––– input –––
mysql -h0 -P1306 -e "create cluster ${CLUSTER_NAME}"; echo $?;
––– output –––
0
––– input –––
for n in `seq 2 $INSTANCE`; do mysql -h0 -P${n}306 -e "join cluster ${CLUSTER_NAME} at '127.0.0.1:1312'"; done; echo $?;
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "create table ${CLUSTER_NAME}:tbl1(id bigint) shards=3 rf=1;"; echo $?;
––– output –––
0
––– input –––
mysql -h0 -P1306 -e "DROP SHARDED TABLE ${CLUSTER_NAME}:tbl1;"; echo $?;
––– output –––
0
––– input –––
sleep 3
––– output –––
––– input –––
mysql -h0 -P1306 -e "SHOW TABLES\G"
––– output –––
*************************** 1. row ***************************
Table: _sharding_queue
Type: rt
*************************** 2. row ***************************
Table: _sharding_state
Type: rt
*************************** 3. row ***************************
Table: _sharding_table
Type: rt
––– input –––
mysql -h0 -P2306 -e "select * from _sharding_queue order by id asc limit 1000;"
––– output –––
+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+-------+-----------+---------------+---------------+----------+
| id             | node           | query                                                                                                                       | wait_for_id | tries | status    | created_at    | updated_at    | duration |
+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+-------+-----------+---------------+---------------+----------+
| %{NUMBER} | 127.0.0.1:1312 | CREATE TABLE IF NOT EXISTS `tbl1_s0` (id bigint)                                                                            |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:1312 | CREATE TABLE IF NOT EXISTS `tbl1_s2` (id bigint)                                                                            |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:2312 | CREATE TABLE IF NOT EXISTS `tbl1_s1` (id bigint)                                                                            |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:1312 | CREATE TABLE `tbl1`
type='distributed' local='tbl1_s0' local='tbl1_s2' agent='127.0.0.1:2312:tbl1_s1'
|           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:2312 | CREATE TABLE `tbl1`
type='distributed' local='tbl1_s1' agent='127.0.0.1:1312:tbl1_s0' agent='127.0.0.1:1312:tbl1_s2'
|           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:2312 | DROP TABLE IF EXISTS tbl1                                                                                                   |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:2312 | DROP TABLE IF EXISTS tbl1_s1                                                                                                |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:1312 | DROP TABLE IF EXISTS tbl1                                                                                                   |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:1312 | DROP TABLE IF EXISTS tbl1_s0                                                                                                |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
| %{NUMBER} | 127.0.0.1:1312 | DROP TABLE IF EXISTS tbl1_s2                                                                                                |           %{NUMBER} |     %{NUMBER} | processed | %{NUMBER} | %{NUMBER} |        %{NUMBER} |
+----------------+----------------+-----------------------------------------------------------------------------------------------------------------------------+-------------+-------+-----------+---------------+---------------+----------+
––– input –––
cat /var/log/manticore-1/searchd.log
––– output –––
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] watchdog: main process %{NUMBER} forked ok
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] Using local time zone '/etc/localtime'
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] starting daemon version '%{SEMVER} %{COMMITDATE} dev (columnar %{SEMVER} %{COMMITDATE}) (secondary %{SEMVER} %{COMMITDATE}) (knn %{SEMVER} %{COMMITDATE})' ...
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] listening on all interfaces for mysql, port=1306
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] listening on all interfaces for sphinx and http(s), port=1312
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] listening on all interfaces for sphinx and http(s), port=1308
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] prereading 0 tables
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] preread 0 tables in #!/[0-9]{1}.[0-9]{3}/!# sec
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] accepting connections
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY] started v%{SEMVER} '/usr/share/manticore/modules/manticore-buddy/bin/manticore-buddy --listen=http://0.0.0.0:%{NUMBER} --bind=127.0.0.1  --threads=8' at http://127.0.0.1:%{NUMBER}
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY] Loaded plugins:
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY]   core: empty-string, backup, emulate-elastic, fuzzy, create, drop, insert, alias, select, show, cli-table, plugin, test, alter-column, alter-distributed-table, alter-rename-table, modify-table, knn, replace, queue, sharding, update, autocomplete
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY]   local:
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY]   extra:
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] WARNING: No persistent state found. Bootstraping with default state
[#!/[A-Za-z]{3}\s[A-Za-z]{3}\s{1,2}[0-9]{1,2}\s[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]{3}\s[0-9]{4}/!#] [%{NUMBER}] [BUDDY] [i] becoming master
